pipeline{
    agent any
    stages {
        stage ('Get project from Github'){
            steps{
                script{
                    checkout([$class: 'GitSCM', branches: [[name: '*/main']],
                        userRemoteConfigs: [[
                            credentialsId: 'MyGithub',
                            url: 'https://github.com/amine-souki/backend_CICD.git']]])
                }
            }
        }
        stage('Cleaning the project') {
            steps{
                sh 'mvn -B -DskipTests clean ' 
            }
        }
        stage('Artifact Construction') {
            steps{
                sh 'mvn -B -DskipTests package' 
            }
        }
        stage('Code Analysis with SonarQube') {
            steps{
                sh 'ssh dockeradmin@3.239.13.85'
                sh 'docker run -d -p 9000:9000 sonarqube:8.9.7-community'
                sh 'mvn sonar:sonar -Dsonar.projectKey=sonarCICD -Dsonar.host.url=http://192.168.1.16:9000 -Dsonar.login=bebc5d801f9b0b7a26a4c67099314df083fc7bce' 
            }
        }

    }
}
       
